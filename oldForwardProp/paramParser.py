import re
import numpy as np

# === Define layer parameter shapes (weights and biases) ===
# These must match your model's expected tensor shapes

LAYER_SHAPES = {
    "cnnlayer00": {"weight": (12, 2, 3), "bias": (12,)},
    "cnnlayer01": {"weight": (12, 12, 3), "bias": (12,)},
    "cnnlayer10": {"weight": (24, 12, 3), "bias": (24,)},
    "cnnlayer11": {"weight": (24, 24, 3), "bias": (24,)},
    "cnnlayer20": {"weight": (32, 24, 3), "bias": (32,)},
    "cnnlayer21": {"weight": (32, 32, 3), "bias": (32,)},
    "fullyconnected0": {"weight": (100, 4096), "bias": (100,)},
    "fullyconnected1": {"weight": (100, 100), "bias": (100,)},
    "fullyconnected2": {"weight": (24, 100), "bias": (24,)},
}
input = [1.000000,0.998114,0.992458,0.983040,0.969886,0.953034,0.932539,0.908469,0.880903,0.849939,0.815685,0.778264,0.737810,0.694472,0.648408,0.599790,0.548799,0.495627,0.440475,0.383553,0.325078,0.265277,0.204379,0.142622,0.080247,0.017499,-0.045376,-0.108127,-0.170506,-0.232263,-0.293150,-0.352922,-0.411337,-0.468157,-0.523149,-0.576087,-0.626754,-0.674939,-0.720440,-0.763066,-0.802638,-0.838987,-0.871957,-0.901405,-0.927202,-0.949234,-0.967403,-0.981623,-0.991827,-0.997964,-1.000000,-0.997916,-0.991711,-0.981403,-0.967024,-0.948626,-0.926276,-0.900059,-0.870076,-0.836444,-0.799297,-0.758783,-0.715064,-0.668319,-0.618738,-0.566523,-0.511891,-0.455068,-0.396289,-0.335800,-0.273854,-0.210711,-0.146638,-0.081905,-0.016788,0.048438,0.113493,0.178099,0.241980,0.304860,0.366468,0.426539,0.484811,0.541031,0.594956,0.646348,0.694983,0.740647,0.783139,0.822272,0.857871,0.889779,0.917851,0.941963,0.962005,0.977886,0.989531,0.996887,0.999915,0.998600,0.992943,0.982963,0.968702,0.950218,0.927587,0.900906,0.870289,0.835865,0.797784,0.756210,0.711323,0.663317,0.612401,0.558797,0.502739,0.444471,0.384250,0.322337,0.259005,0.194531,0.129199,0.063295,-0.002892,-0.069070,-0.134948,-0.200237,-0.264649,-0.327902,-0.389717,-0.449821,-0.507952,-0.563854,-0.617280,-0.667997,-0.715782,-0.760425,-0.801731,-0.839519,-0.873625,-0.903900,-0.930212,-0.952447,-0.970511,-0.984324,-0.993829,-0.998987,-0.999777,-0.996199,-0.988270,-0.976029,-0.959532,-0.938853,-0.914088,-0.885347,-0.852758,-0.816468,-0.776638,-0.733444,-0.687078,-0.637745,-0.585662,-0.531058,-0.474174,-0.415259,-0.354570,-0.292373,-0.228938,-0.164541,-0.099463,-0.033984,0.031612,0.097042,0.162025,0.226282,0.289537,0.351521,0.411969,0.470626,0.527242,0.581579,0.633408,0.682512,0.728687,0.771741,0.811496,0.847790,0.880473,0.909416,0.934501,0.955630,0.972721,0.985710,0.994551,0.999213,0.999686,0.995977,0.988108,0.976123,0.960078,0.940051,0.916132,0.888429,0.857067,0.822181,0.783926,0.742467,0.697981,0.650660,0.600704,0.548324,0.493742,0.437185,0.378891,0.319100,0.258060,0.196022,0.133241,0.069974,0.006476,-0.056994,-0.120180,-0.182830,-0.244692,-0.305521,-0.365075,-0.423119,-0.479427,-0.533778,-0.585962,-0.635777,-0.683031,-0.727546,-0.769154,-0.807697,-0.843032,-0.875031,-0.903577,-0.928567,-0.949914,-0.967546,-0.981404,-0.991445,-0.997641,-0.999978,-0.998460,-0.993102,-0.983937,-0.971010,-0.954382,-0.934126,-0.910332,-0.883099,-0.852541,-0.818784,-0.781964,-0.742229,-0.699739,-0.654660,-0.607169,-0.557452,-0.505700,-0.452114,-0.396897,-0.340260,-0.282417,-0.223586,-0.163986,-0.103841,-0.043372,0.017197,0.077644,0.137749,0.197292,0.256059,0.313837,0.370422,0.425610,0.479207,0.531023,0.580878,0.628598,0.674017,0.716980,0.757341,0.794963,0.829719,0.861495,0.890185,0.915698,0.937953,0.956878,0.972418,0.984527,0.993172,0.998332,0.999999,0.998176,0.992879,0.984135,0.971984,0.956477,0.937677,0.915656,0.890498,0.862299,0.831163,0.797203,0.760543,0.721315,0.679658,0.635720,0.589656,0.541627,0.491800,0.440348,0.387447,0.333281,0.278032,0.221890,0.165045,0.107688,0.050011,-0.007790,-0.065525,-0.123001,-0.180028,-0.236417,-0.291983,-0.346544,-0.399922,-0.451942,-0.502437,-0.551242,-0.598201,-0.643163,-0.685983,-0.726527,-0.764664,-0.800275,-0.833248,-0.863479,-0.890875,-0.915351,-0.936832,-0.955253,-0.970558,-0.982704,-0.991654,-0.997384,-0.999881,-0.999140,-0.995168,-0.987982,-0.977609,-0.964085,-0.947458,-0.927785,-0.905132,-0.879575,-0.851198,-0.820095,-0.786368,-0.750127,-0.711490,-0.670582,-0.627536,-0.582491,-0.535591,-0.486987,-0.436836,-0.385297,-0.332536,-0.278721,-0.224024,-0.168619,-0.112682,-0.056392,0.000073,0.056532,0.112807,0.168719,0.224091,0.278746,0.332511,0.385215,0.436692,0.486776,0.535311,0.582140,0.627115,0.670092,0.710935,0.749514,0.785704,0.819390,0.850464,0.878826,0.904385,0.927056,0.946768,0.963454,0.977061,0.987543,0.994864,0.998998,0.999930,0.997654,0.992175,0.983507,0.971675,0.956715,0.938671,0.917597,0.893559,0.866630,0.836893,0.804441,0.769375,0.731805,0.691849,0.649633,0.605290,0.558961,0.510794,0.460940,0.409561,0.356821,0.302888,0.247937,0.192146,0.135694,0.078766,0.021547,-0.035777,-0.093017,-0.149985,-0.206494,-0.262357,-0.317388,-0.371404,-0.424225,-0.475673,-0.525575,-0.573762,-0.620071,-0.664343,-0.706427,-0.746178,-0.783457,-0.818134,-0.850087,-0.879203,-0.905377,-0.928514,-0.948530,-0.965349,-0.978906,-0.989149,-0.996034,-0.999529,-0.999615,-0.996282,-0.989534,-0.979385,-0.965861,-0.949001,-0.928853,-0.905479,-0.878951,-0.849352,-0.816778,-0.781334,-0.743134,-0.702306,-0.658985,-0.613315,-0.565450,-0.515553,-0.463794,-0.410349,-0.355404,-0.299149,-0.241778,-0.183495,-0.124502,-0.065009,-0.005228,0.054630,0.114348,0.173712,0.232507,0.290520,0.347536,0.403349,0.457750,0.510538,0.561517,0.610493,0.657283,0.701707,0.743597,0.782789,0.819133,0.852484,0.882710,0.909691,0.933316,0.953487,0.970119,0.983138,0.992487,0.998118,1.000000,0.998114,0.992458,0.983040,0.969886,0.953034,0.932539,0.908469,0.880903,0.849939,0.815685,0.778264,0.737810,0.694472,0.648408,0.599790,0.548799,0.495627,0.440475,0.383553,0.325078,0.265277,0.204379,0.142622,0.080247,0.017499,-0.045376,-0.108127,-0.170506,-0.232263,-0.293150,-0.352922,-0.411337,-0.468157,-0.523149,-0.576087,-0.626754,-0.674939,-0.720440,-0.763066,-0.802638,-0.838987,-0.871957,-0.901405,-0.927202,-0.949234,-0.967403,-0.981623,-0.991827,-0.997964,-1.000000,-0.997916,-0.991711,-0.981403,-0.967024,-0.948626,-0.926276,-0.900059,-0.870076,-0.836444,-0.799297,-0.758783,-0.715064,-0.668319,-0.618738,-0.566523,-0.511891,-0.455068,-0.396289,-0.335800,-0.273854,-0.210711,-0.146638,-0.081905,-0.016788,0.048438,0.113493,0.178099,0.241980,0.304860,0.366468,0.426539,0.484811,0.541031,0.594956,0.646348,0.694983,0.740647,0.783139,0.822272,0.857871,0.889779,0.917851,0.941963,0.962005,0.977886,0.989531,0.996887,0.999915,0.998600,0.992943,0.982963,0.968702,0.950218,0.927587,0.900906,0.870289,0.835865,0.797784,0.756210,0.711323,0.663317,0.612401,0.558797,0.502739,0.444471,0.384250,0.322337,0.259005,0.194531,0.129199,0.063295,-0.002892,-0.069070,-0.134948,-0.200237,-0.264649,-0.327902,-0.389717,-0.449821,-0.507952,-0.563854,-0.617280,-0.667997,-0.715782,-0.760425,-0.801731,-0.839519,-0.873625,-0.903900,-0.930212,-0.952447,-0.970511,-0.984324,-0.993829,-0.998987,-0.999777,-0.996199,-0.988270,-0.976029,-0.959532,-0.938853,-0.914088,-0.885347,-0.852758,-0.816468,-0.776638,-0.733444,-0.687078,-0.637745,-0.585662,-0.531058,-0.474174,-0.415259,-0.354570,-0.292373,-0.228938,-0.164541,-0.099463,-0.033984,0.031612,0.097042,0.162025,0.226282,0.289537,0.351521,0.411969,0.470626,0.527242,0.581579,0.633408,0.682512,0.728687,0.771741,0.811496,0.847790,0.880473,0.909416,0.934501,0.955630,0.972721,0.985710,0.994551,0.999213,0.999686,0.995977,0.988108,0.976123,0.960078,0.940051,0.916132,0.888429,0.857067,0.822181,0.783926,0.742467,0.697981,0.650660,0.600704,0.548324,0.493742,0.437185,0.378891,0.319100,0.258060,0.196022,0.133241,0.069974,0.006476,-0.056994,-0.120180,-0.182830,-0.244692,-0.305521,-0.365075,-0.423119,-0.479427,-0.533778,-0.585962,-0.635777,-0.683031,-0.727546,-0.769154,-0.807697,-0.843032,-0.875031,-0.903577,-0.928567,-0.949914,-0.967546,-0.981404,-0.991445,-0.997641,-0.999978,-0.998460,-0.993102,-0.983937,-0.971010,-0.954382,-0.934126,-0.910332,-0.883099,-0.852541,-0.818784,-0.781964,-0.742229,-0.699739,-0.654660,-0.607169,-0.557452,-0.505700,-0.452114,-0.396897,-0.340260,-0.282417,-0.223586,-0.163986,-0.103841,-0.043372,0.017197,0.077644,0.137749,0.197292,0.256059,0.313837,0.370422,0.425610,0.479207,0.531023,0.580878,0.628598,0.674017,0.716980,0.757341,0.794963,0.829719,0.861495,0.890185,0.915698,0.937953,0.956878,0.972418,0.984527,0.993172,0.998332,0.999999,0.998176,0.992879,0.984135,0.971984,0.956477,0.937677,0.915656,0.890498,0.862299,0.831163,0.797203,0.760543,0.721315,0.679658,0.635720,0.589656,0.541627,0.491800,0.440348,0.387447,0.333281,0.278032,0.221890,0.165045,0.107688,0.050011,-0.007790,-0.065525,-0.123001,-0.180028,-0.236417,-0.291983,-0.346544,-0.399922,-0.451942,-0.502437,-0.551242,-0.598201,-0.643163,-0.685983,-0.726527,-0.764664,-0.800275,-0.833248,-0.863479,-0.890875,-0.915351,-0.936832,-0.955253,-0.970558,-0.982704,-0.991654,-0.997384,-0.999881,-0.999140,-0.995168,-0.987982,-0.977609,-0.964085,-0.947458,-0.927785,-0.905132,-0.879575,-0.851198,-0.820095,-0.786368,-0.750127,-0.711490,-0.670582,-0.627536,-0.582491,-0.535591,-0.486987,-0.436836,-0.385297,-0.332536,-0.278721,-0.224024,-0.168619,-0.112682,-0.056392,0.000073,0.056532,0.112807,0.168719,0.224091,0.278746,0.332511,0.385215,0.436692,0.486776,0.535311,0.582140,0.627115,0.670092,0.710935,0.749514,0.785704,0.819390,0.850464,0.878826,0.904385,0.927056,0.946768,0.963454,0.977061,0.987543,0.994864,0.998998,0.999930,0.997654,0.992175,0.983507,0.971675,0.956715,0.938671,0.917597,0.893559,0.866630,0.836893,0.804441,0.769375,0.731805,0.691849,0.649633,0.605290,0.558961,0.510794,0.460940,0.409561,0.356821,0.302888,0.247937,0.192146,0.135694,0.078766,0.021547,-0.035777,-0.093017,-0.149985,-0.206494,-0.262357,-0.317388,-0.371404,-0.424225,-0.475673,-0.525575,-0.573762,-0.620071,-0.664343,-0.706427,-0.746178,-0.783457,-0.818134,-0.850087,-0.879203,-0.905377,-0.928514,-0.948530,-0.965349,-0.978906,-0.989149,-0.996034,-0.999529,-0.999615,-0.996282,-0.989534,-0.979385,-0.965861,-0.949001,-0.928853,-0.905479,-0.878951,-0.849352,-0.816778,-0.781334,-0.743134,-0.702306,-0.658985,-0.613315,-0.565450,-0.515553,-0.463794,-0.410349,-0.355404,-0.299149,-0.241778,-0.183495,-0.124502,-0.065009,-0.005228,0.054630,0.114348,0.173712,0.232507,0.290520,0.347536,0.403349,0.457750,0.510538,0.561517,0.610493,0.657283,0.701707,0.743597,0.782789,0.819133,0.852484,0.882710,0.909691,0.933316,0.953487,0.970119,0.983138,0.992487,0.998118,0.000000,0.061381,0.122589,0.183393,0.243561,0.302862,0.361068,0.417953,0.473296,0.526881,0.578496,0.627937,0.675008,0.719520,0.761293,0.800157,0.835954,0.868535,0.897765,0.923519,0.945687,0.964172,0.978892,0.989777,0.996775,0.999847,0.998970,0.994137,0.985357,0.972653,0.956066,0.935653,0.911483,0.883646,0.852241,0.817388,0.779217,0.737874,0.693517,0.646320,0.596466,0.544151,0.489583,0.432978,0.374562,0.314570,0.253244,0.190832,0.127589,0.063773,-0.000354,-0.064529,-0.128486,-0.191959,-0.254684,-0.316399,-0.376845,-0.435768,-0.492918,-0.548052,-0.600936,-0.651344,-0.699059,-0.743875,-0.785598,-0.824046,-0.859050,-0.890457,-0.918126,-0.941933,-0.961771,-0.977548,-0.989190,-0.996640,-0.999859,-0.998826,-0.993539,-0.984013,-0.970281,-0.952397,-0.930431,-0.904469,-0.874619,-0.841002,-0.803759,-0.763043,-0.719026,-0.671894,-0.621846,-0.569095,-0.513865,-0.456392,-0.396924,-0.335716,-0.273030,-0.209139,-0.144318,-0.078849,-0.013016,0.052895,0.118597,0.183802,0.248226,0.311587,0.373607,0.434014,0.492542,0.548935,0.602943,0.654329,0.702866,0.748339,0.790547,0.829305,0.864438,0.895793,0.923229,0.946625,0.965876,0.980896,0.991619,0.997995,0.999996,0.997612,0.990853,0.979748,0.964345,0.944712,0.920935,0.893118,0.861385,0.825875,0.786743,0.744164,0.698324,0.649426,0.597686,0.543330,0.486600,0.427744,0.367023,0.304703,0.241059,0.176370,0.110920,0.044997,-0.021109,-0.087110,-0.152717,-0.217641,-0.281601,-0.344317,-0.405516,-0.464931,-0.522306,-0.577391,-0.629948,-0.679750,-0.726584,-0.770248,-0.810556,-0.847335,-0.880431,-0.909703,-0.935029,-0.956304,-0.973441,-0.986370,-0.995041,-0.999422,-0.999500,-0.995280,-0.986787,-0.974062,-0.957167,-0.936180,-0.911198,-0.882333,-0.849715,-0.813490,-0.773818,-0.730874,-0.684847,-0.635937,-0.584358,-0.530333,-0.474096,-0.415888,-0.355961,-0.294570,-0.231977,-0.168449,-0.104254,-0.039664,0.025049,0.089613,0.153760,0.217220,0.279731,0.341035,0.400877,0.459013,0.515206,0.569225,0.620854,0.669883,0.716116,0.759369,0.799472,0.836266,0.869609,0.899371,0.925441,0.947721,0.966129,0.980599,0.991084,0.997549,0.999979,0.998375,0.992752,0.983145,0.969601,0.952185,0.930978,0.906074,0.877582,0.845625,0.810339,0.771873,0.730389,0.686058,0.639064,0.589598,0.537863,0.484067,0.428427,0.371165,0.312510,0.252694,0.191953,0.130525,0.068651,0.006570,-0.055477,-0.117252,-0.178517,-0.239039,-0.298589,-0.356942,-0.413879,-0.469187,-0.522660,-0.574102,-0.623324,-0.670146,-0.714399,-0.755924,-0.794573,-0.830209,-0.862709,-0.891960,-0.917863,-0.940331,-0.959292,-0.974684,-0.986463,-0.994594,-0.999059,-0.999852,-0.996981,-0.990467,-0.980345,-0.966661,-0.949477,-0.928864,-0.904907,-0.877702,-0.847357,-0.813991,-0.777731,-0.738716,-0.697093,-0.653020,-0.606659,-0.558182,-0.507767,-0.455599,-0.401866,-0.346764,-0.290489,-0.233244,-0.175231,-0.116657,-0.057727,0.001352,0.060372,0.119130,0.177422,0.235047,0.291807,0.347509,0.401964,0.454987,0.506399,0.556029,0.603711,0.649287,0.692607,0.733529,0.771920,0.807655,0.840619,0.870708,0.897827,0.921892,0.942828,0.960572,0.975072,0.986286,0.994185,0.998749,0.999970,0.997851,0.992407,0.983661,0.971652,0.956423,0.938034,0.916549,0.892047,0.864614,0.834345,0.801346,0.765730,0.727617,0.687138,0.644429,0.599633,0.552900,0.504385,0.454249,0.402657,0.349780,0.295791,0.240866,0.185185,0.128929,0.072281,0.015423,-0.041459,-0.098184,-0.154569,-0.210431,-0.265594,-0.319879,-0.373115,-0.425130,-0.475761,-0.524845,-0.572228,-0.617759,-0.661294,-0.702697,-0.741835,-0.778588,-0.812837,-0.844478,-0.873409,-0.899541,-0.922793,-0.943091,-0.960372,-0.974584,-0.985681,-0.993631,-0.998409,-1.000000,-0.998401,-0.993617,-0.985664,-0.974568,-0.960365,-0.943099,-0.922827,-0.899611,-0.873527,-0.844655,-0.813089,-0.778927,-0.742278,-0.703257,-0.661989,-0.618603,-0.573236,-0.526033,-0.477142,-0.426718,-0.374922,-0.321917,-0.267872,-0.212958,-0.157350,-0.101224,-0.044760,0.011862,0.068462,0.124859,0.180871,0.236320,0.291026,0.344815,0.397512,0.448946,0.498952,0.547367,0.594033,0.638797,0.681514,0.722042,0.760248,0.796005,0.829194,0.859703,0.887431,0.912283,0.934173,0.953026,0.968776,0.981366,0.990751,0.996893,0.999768,0.999360,0.995665,0.988688,0.978448,0.964971,0.948296,0.928471,0.905557,0.879622,0.850747,0.819022,0.784546,0.747427,0.707785,0.665747,0.621446,0.575028,0.526642,0.476448,0.424609,0.371297,0.316687,0.260963,0.204309,0.146916,0.088977,0.030687,-0.027755,-0.086150,-0.144300,-0.202002,-0.259060,-0.315274,-0.370449,-0.424391,-0.476912,-0.527826,-0.576952,-0.624114,-0.669142,-0.711875,-0.752156,-0.789839,-0.824783,-0.856858,-0.885943,-0.911928,-0.934713,-0.954207,-0.970331,-0.983021,-0.992219,-0.997885,-0.999986,-0.998507,-0.993441,-0.984796,-0.972595,-0.956869,-0.937666,-0.915046,-0.889081,-0.859855,-0.827465,-0.792022,-0.753644,-0.712465,-0.668628,-0.622287,-0.573604,-0.522754,-0.469917,-0.415286,-0.359057,-0.301435,-0.242631,-0.182863,-0.122351,-0.061321,-0.000000,0.061381,0.122589,0.183393,0.243561,0.302862,0.361068,0.417953,0.473296,0.526881,0.578496,0.627937,0.675008,0.719520,0.761293,0.800157,0.835954,0.868535,0.897765,0.923519,0.945687,0.964172,0.978892,0.989777,0.996775,0.999847,0.998970,0.994137,0.985357,0.972653,0.956066,0.935653,0.911483,0.883646,0.852241,0.817388,0.779217,0.737874,0.693517,0.646320,0.596466,0.544151,0.489583,0.432978,0.374562,0.314570,0.253244,0.190832,0.127589,0.063773,-0.000354,-0.064529,-0.128486,-0.191959,-0.254684,-0.316399,-0.376845,-0.435768,-0.492918,-0.548052,-0.600936,-0.651344,-0.699059,-0.743875,-0.785598,-0.824046,-0.859050,-0.890457,-0.918126,-0.941933,-0.961771,-0.977548,-0.989190,-0.996640,-0.999859,-0.998826,-0.993539,-0.984013,-0.970281,-0.952397,-0.930431,-0.904469,-0.874619,-0.841002,-0.803759,-0.763043,-0.719026,-0.671894,-0.621846,-0.569095,-0.513865,-0.456392,-0.396924,-0.335716,-0.273030,-0.209139,-0.144318,-0.078849,-0.013016,0.052895,0.118597,0.183802,0.248226,0.311587,0.373607,0.434014,0.492542,0.548935,0.602943,0.654329,0.702866,0.748339,0.790547,0.829305,0.864438,0.895793,0.923229,0.946625,0.965876,0.980896,0.991619,0.997995,0.999996,0.997612,0.990853,0.979748,0.964345,0.944712,0.920935,0.893118,0.861385,0.825875,0.786743,0.744164,0.698324,0.649426,0.597686,0.543330,0.486600,0.427744,0.367023,0.304703,0.241059,0.176370,0.110920,0.044997,-0.021109,-0.087110,-0.152717,-0.217641,-0.281601,-0.344317,-0.405516,-0.464931,-0.522306,-0.577391,-0.629948,-0.679750,-0.726584,-0.770248,-0.810556,-0.847335,-0.880431,-0.909703,-0.935029,-0.956304,-0.973441,-0.986370,-0.995041,-0.999422,-0.999500,-0.995280,-0.986787,-0.974062,-0.957167,-0.936180,-0.911198,-0.882333,-0.849715,-0.813490,-0.773818,-0.730874,-0.684847,-0.635937,-0.584358,-0.530333,-0.474096,-0.415888,-0.355961,-0.294570,-0.231977,-0.168449,-0.104254,-0.039664,0.025049,0.089613,0.153760,0.217220,0.279731,0.341035,0.400877,0.459013,0.515206,0.569225,0.620854,0.669883,0.716116,0.759369,0.799472,0.836266,0.869609,0.899371,0.925441,0.947721,0.966129,0.980599,0.991084,0.997549,0.999979,0.998375,0.992752,0.983145,0.969601,0.952185,0.930978,0.906074,0.877582,0.845625,0.810339,0.771873,0.730389,0.686058,0.639064,0.589598,0.537863,0.484067,0.428427,0.371165,0.312510,0.252694,0.191953,0.130525,0.068651,0.006570,-0.055477,-0.117252,-0.178517,-0.239039,-0.298589,-0.356942,-0.413879,-0.469187,-0.522660,-0.574102,-0.623324,-0.670146,-0.714399,-0.755924,-0.794573,-0.830209,-0.862709,-0.891960,-0.917863,-0.940331,-0.959292,-0.974684,-0.986463,-0.994594,-0.999059,-0.999852,-0.996981,-0.990467,-0.980345,-0.966661,-0.949477,-0.928864,-0.904907,-0.877702,-0.847357,-0.813991,-0.777731,-0.738716,-0.697093,-0.653020,-0.606659,-0.558182,-0.507767,-0.455599,-0.401866,-0.346764,-0.290489,-0.233244,-0.175231,-0.116657,-0.057727,0.001352,0.060372,0.119130,0.177422,0.235047,0.291807,0.347509,0.401964,0.454987,0.506399,0.556029,0.603711,0.649287,0.692607,0.733529,0.771920,0.807655,0.840619,0.870708,0.897827,0.921892,0.942828,0.960572,0.975072,0.986286,0.994185,0.998749,0.999970,0.997851,0.992407,0.983661,0.971652,0.956423,0.938034,0.916549,0.892047,0.864614,0.834345,0.801346,0.765730,0.727617,0.687138,0.644429,0.599633,0.552900,0.504385,0.454249,0.402657,0.349780,0.295791,0.240866,0.185185,0.128929,0.072281,0.015423,-0.041459,-0.098184,-0.154569,-0.210431,-0.265594,-0.319879,-0.373115,-0.425130,-0.475761,-0.524845,-0.572228,-0.617759,-0.661294,-0.702697,-0.741835,-0.778588,-0.812837,-0.844478,-0.873409,-0.899541,-0.922793,-0.943091,-0.960372,-0.974584,-0.985681,-0.993631,-0.998409,-1.000000,-0.998401,-0.993617,-0.985664,-0.974568,-0.960365,-0.943099,-0.922827,-0.899611,-0.873527,-0.844655,-0.813089,-0.778927,-0.742278,-0.703257,-0.661989,-0.618603,-0.573236,-0.526033,-0.477142,-0.426718,-0.374922,-0.321917,-0.267872,-0.212958,-0.157350,-0.101224,-0.044760,0.011862,0.068462,0.124859,0.180871,0.236320,0.291026,0.344815,0.397512,0.448946,0.498952,0.547367,0.594033,0.638797,0.681514,0.722042,0.760248,0.796005,0.829194,0.859703,0.887431,0.912283,0.934173,0.953026,0.968776,0.981366,0.990751,0.996893,0.999768,0.999360,0.995665,0.988688,0.978448,0.964971,0.948296,0.928471,0.905557,0.879622,0.850747,0.819022,0.784546,0.747427,0.707785,0.665747,0.621446,0.575028,0.526642,0.476448,0.424609,0.371297,0.316687,0.260963,0.204309,0.146916,0.088977,0.030687,-0.027755,-0.086150,-0.144300,-0.202002,-0.259060,-0.315274,-0.370449,-0.424391,-0.476912,-0.527826,-0.576952,-0.624114,-0.669142,-0.711875,-0.752156,-0.789839,-0.824783,-0.856858,-0.885943,-0.911928,-0.934713,-0.954207,-0.970331,-0.983021,-0.992219,-0.997885,-0.999986,-0.998507,-0.993441,-0.984796,-0.972595,-0.956869,-0.937666,-0.915046,-0.889081,-0.859855,-0.827465,-0.792022,-0.753644,-0.712465,-0.668628,-0.622287,-0.573604,-0.522754,-0.469917,-0.415286,-0.359057,-0.301435,-0.242631,-0.182863,-0.122351,-0.061321]

# === Parse the params.h file and return layer-wise weight/bias arrays ===

def parse_params_file(filepath):
    with open(filepath, 'r') as f:
        content = f.read()

    # Grab everything inside paramVector[] = { ... };
    float_string = re.search(r'paramVector\[\] = \{(.+?)\};', content, re.DOTALL)
    if not float_string:
        raise ValueError("Could not find 'paramVector[] = {...}' array in the file.")
    
    raw_values = float_string.group(1)

    # Remove all comments (/* ... */)
    raw_values = re.sub(r'/\*.*?\*/', '', raw_values, flags=re.DOTALL)

    # Clean and convert to list of floats
    tokens = [val.strip() for val in raw_values.split(',') if val.strip()]
    float_values = np.array([float(tok) for tok in tokens], dtype=np.float32)

    # Split into weights and biases using LAYER_SHAPES
    idx = 0
    layer_params = {}

    for layer_name, shape_dict in LAYER_SHAPES.items():
        weight_shape = shape_dict["weight"]
        bias_shape = shape_dict["bias"]

        weight_count = np.prod(weight_shape)
        bias_count = np.prod(bias_shape)

        weights_flat = float_values[idx : idx + weight_count]
        idx += weight_count
        biases_flat = float_values[idx : idx + bias_count]
        idx += bias_count

        # Reshape and store
        weights = weights_flat.reshape(weight_shape)
        biases = biases_flat.reshape(bias_shape)

        layer_params[layer_name] = {
            "weight": weights,
            "bias": biases,
        }

    return layer_params


# === Main: Print summary (optional test run) ===

if __name__ == "__main__":
    param_path = "params.h"  # Adjust if needed
    layer_params = parse_params_file(param_path)

    for layer_name, tensors in layer_params.items():
        print(f"{layer_name}: weights shape = {tensors['weight'].shape}, biases shape = {tensors['bias'].shape}")